{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import counterService from'../services/counter';import'./Counter.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Counter(){const[stats,setStats]=useState({total:0,today:0,formatted:{total:'0',today:'0'}});const[loading,setLoading]=useState(true);const[isUpdating,setIsUpdating]=useState(false);const fetchStats=useCallback(async()=>{try{setIsUpdating(true);const data=await counterService.getStats();// Si le total a augmentÃ©, on a une nouvelle analyse\nsetStats(prevStats=>{const newTotal=data.total||0;const prevTotal=prevStats.total||0;if(newTotal>prevTotal&&prevTotal>0){// Animation de cÃ©lÃ©bration\nconsole.log('[COUNTER] âœ… Nouvelle analyse dÃ©tectÃ©e !',prevTotal,'â†’',newTotal);}return{total:newTotal,today:data.today||0,formatted:{total:counterService.formatNumber(newTotal),today:(data.today||0).toString()}};});}catch(error){console.error('[COUNTER] Erreur:',error);}finally{setLoading(false);// Garder l'indicateur de mise Ã  jour un peu plus longtemps pour que l'utilisateur le voie\nsetTimeout(()=>setIsUpdating(false),1500);}},[]);useEffect(()=>{fetchStats();// Ã‰couter les Ã©vÃ©nements de mise Ã  jour du compteur\nconst handleCounterUpdate=()=>{console.log('[COUNTER] Mise Ã  jour demandÃ©e');fetchStats();};window.addEventListener('counter:update',handleCounterUpdate);// RafraÃ®chir toutes les 5 minutes\nconst interval=setInterval(fetchStats,5*60*1000);return()=>{window.removeEventListener('counter:update',handleCounterUpdate);clearInterval(interval);};},[fetchStats]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"counter-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"counter-loading\",children:\"...\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"counter-container \".concat(isUpdating?'counter-updating':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"counter-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"counter-label\",children:\"Sites analys\\xE9s\"}),/*#__PURE__*/_jsx(\"span\",{className:\"counter-value\",children:stats.formatted.total||stats.total}),isUpdating&&/*#__PURE__*/_jsx(\"span\",{className:\"counter-update-indicator\",children:\"\\uD83D\\uDD04\"})]}),stats.today>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"counter-item counter-today\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"counter-label\",children:\"Aujourd'hui\"}),/*#__PURE__*/_jsx(\"span\",{className:\"counter-value\",children:stats.today})]})]});}export default Counter;","map":{"version":3,"names":["React","useState","useEffect","useCallback","counterService","jsx","_jsx","jsxs","_jsxs","Counter","stats","setStats","total","today","formatted","loading","setLoading","isUpdating","setIsUpdating","fetchStats","data","getStats","prevStats","newTotal","prevTotal","console","log","formatNumber","toString","error","setTimeout","handleCounterUpdate","window","addEventListener","interval","setInterval","removeEventListener","clearInterval","className","children","concat"],"sources":["/Users/ares/DEV/Visibility strategy score/frontend/src/components/Counter.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport counterService from '../services/counter';\nimport './Counter.css';\n\nfunction Counter() {\n  const [stats, setStats] = useState({ total: 0, today: 0, formatted: { total: '0', today: '0' } });\n  const [loading, setLoading] = useState(true);\n  const [isUpdating, setIsUpdating] = useState(false);\n\n  const fetchStats = useCallback(async () => {\n    try {\n      setIsUpdating(true);\n      const data = await counterService.getStats();\n      \n      // Si le total a augmentÃ©, on a une nouvelle analyse\n      setStats((prevStats) => {\n        const newTotal = data.total || 0;\n        const prevTotal = prevStats.total || 0;\n        \n        if (newTotal > prevTotal && prevTotal > 0) {\n          // Animation de cÃ©lÃ©bration\n          console.log('[COUNTER] âœ… Nouvelle analyse dÃ©tectÃ©e !', prevTotal, 'â†’', newTotal);\n        }\n        \n        return {\n          total: newTotal,\n          today: data.today || 0,\n          formatted: {\n            total: counterService.formatNumber(newTotal),\n            today: (data.today || 0).toString()\n          }\n        };\n      });\n    } catch (error) {\n      console.error('[COUNTER] Erreur:', error);\n    } finally {\n      setLoading(false);\n      // Garder l'indicateur de mise Ã  jour un peu plus longtemps pour que l'utilisateur le voie\n      setTimeout(() => setIsUpdating(false), 1500);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchStats();\n    \n    // Ã‰couter les Ã©vÃ©nements de mise Ã  jour du compteur\n    const handleCounterUpdate = () => {\n      console.log('[COUNTER] Mise Ã  jour demandÃ©e');\n      fetchStats();\n    };\n\n    window.addEventListener('counter:update', handleCounterUpdate);\n    \n    // RafraÃ®chir toutes les 5 minutes\n    const interval = setInterval(fetchStats, 5 * 60 * 1000);\n    \n    return () => {\n      window.removeEventListener('counter:update', handleCounterUpdate);\n      clearInterval(interval);\n    };\n  }, [fetchStats]);\n\n  if (loading) {\n    return (\n      <div className=\"counter-container\">\n        <div className=\"counter-loading\">...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`counter-container ${isUpdating ? 'counter-updating' : ''}`}>\n      <div className=\"counter-item\">\n        <span className=\"counter-label\">Sites analysÃ©s</span>\n        <span className=\"counter-value\">{stats.formatted.total || stats.total}</span>\n        {isUpdating && <span className=\"counter-update-indicator\">ðŸ”„</span>}\n      </div>\n      {stats.today > 0 && (\n        <div className=\"counter-item counter-today\">\n          <span className=\"counter-label\">Aujourd'hui</span>\n          <span className=\"counter-value\">{stats.today}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Counter;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}