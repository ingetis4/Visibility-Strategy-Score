{"ast":null,"code":"import React,{useEffect,useState,useCallback}from'react';import'./CalendlyModal.css';import apiService from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const CALENDLY_URL=process.env.REACT_APP_CALENDLY_URL||'https://calendly.com/djerbi/audit-gratuite-pour-evaluer-vos-besoins';function CalendlyModal(_ref){let{isOpen,onClose,onEventScheduled,userData}=_ref;const[isConfirmed,setIsConfirmed]=useState(false);const handleCalendlyEvent=useCallback(e=>{if(e.data.event&&e.data.event.indexOf('calendly')===0){if(e.data.event==='calendly.event_scheduled'){setIsConfirmed(true);// Envoyer les données à l'API après un court délai pour laisser Calendly terminer\nsetTimeout(async()=>{if(onEventScheduled&&userData){try{await apiService.post('/api/confirm-appointment',{email:userData.email,url:userData.url,sector:userData.sector,offer:userData.offer,analysis_type:userData.analysis_type,results:userData.results});onEventScheduled(userData);}catch(error){console.error('Erreur lors de l\\'envoi de la confirmation:',error);}}},2000);}}},[onEventScheduled,userData]);useEffect(()=>{if(isOpen){// Charger le script Calendly si pas déjà chargé\nif(!window.Calendly){const script=document.createElement('script');script.src='https://assets.calendly.com/assets/external/widget.js';script.async=true;document.body.appendChild(script);}// Attendre que Calendly soit chargé puis initialiser le widget\nconst initCalendly=()=>{if(window.Calendly){window.Calendly.initInlineWidget({url:CALENDLY_URL,parentElement:document.querySelector('.calendly-inline-widget')});}else{setTimeout(initCalendly,100);}};setTimeout(initCalendly,500);// Écouter les événements Calendly\nwindow.addEventListener('message',handleCalendlyEvent);}return()=>{window.removeEventListener('message',handleCalendlyEvent);};},[isOpen,handleCalendlyEvent]);if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"calendly-modal-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"calendly-modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"button\",{className:\"calendly-modal-close\",onClick:onClose,children:\"\\xD7\"}),!isConfirmed?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"calendly-modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"calendly-modal-title\",children:\"R\\xE9servez votre audit gratuit\"}),/*#__PURE__*/_jsx(\"p\",{className:\"calendly-modal-subtitle\",children:\"Choisissez un cr\\xE9neau qui vous convient pour discuter de vos r\\xE9sultats\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"calendly-inline-widget\",\"data-url\":CALENDLY_URL,style:{minWidth:'320px',height:'700px'}})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"calendly-confirmation\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"confirmation-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"confirmation-title\",children:\"Rendez-vous confirm\\xE9 !\"}),/*#__PURE__*/_jsx(\"p\",{className:\"confirmation-message\",children:\"Merci ! Votre rendez-vous a \\xE9t\\xE9 enregistr\\xE9. Vous allez recevoir un email de confirmation de Calendly.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"confirmation-message\",children:\"Nous vous enverrons \\xE9galement un r\\xE9capitulatif de votre analyse par email.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"confirmation-button\",onClick:onClose,children:\"Fermer\"})]})]})});}export default CalendlyModal;","map":{"version":3,"names":["React","useEffect","useState","useCallback","apiService","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CALENDLY_URL","process","env","REACT_APP_CALENDLY_URL","CalendlyModal","_ref","isOpen","onClose","onEventScheduled","userData","isConfirmed","setIsConfirmed","handleCalendlyEvent","e","data","event","indexOf","setTimeout","post","email","url","sector","offer","analysis_type","results","error","console","window","Calendly","script","document","createElement","src","async","body","appendChild","initCalendly","initInlineWidget","parentElement","querySelector","addEventListener","removeEventListener","className","onClick","children","stopPropagation","style","minWidth","height"],"sources":["/Users/ares/DEV/Visibility strategy score/frontend/src/components/CalendlyModal.js"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport './CalendlyModal.css';\nimport apiService from '../services/api';\n\nconst CALENDLY_URL = process.env.REACT_APP_CALENDLY_URL || 'https://calendly.com/djerbi/audit-gratuite-pour-evaluer-vos-besoins';\n\nfunction CalendlyModal({ isOpen, onClose, onEventScheduled, userData }) {\n  const [isConfirmed, setIsConfirmed] = useState(false);\n\n  const handleCalendlyEvent = useCallback((e) => {\n    if (e.data.event && e.data.event.indexOf('calendly') === 0) {\n      if (e.data.event === 'calendly.event_scheduled') {\n        setIsConfirmed(true);\n        // Envoyer les données à l'API après un court délai pour laisser Calendly terminer\n        setTimeout(async () => {\n          if (onEventScheduled && userData) {\n            try {\n              await apiService.post('/api/confirm-appointment', {\n                email: userData.email,\n                url: userData.url,\n                sector: userData.sector,\n                offer: userData.offer,\n                analysis_type: userData.analysis_type,\n                results: userData.results\n              });\n              onEventScheduled(userData);\n            } catch (error) {\n              console.error('Erreur lors de l\\'envoi de la confirmation:', error);\n            }\n          }\n        }, 2000);\n      }\n    }\n  }, [onEventScheduled, userData]);\n\n  useEffect(() => {\n    if (isOpen) {\n      // Charger le script Calendly si pas déjà chargé\n      if (!window.Calendly) {\n        const script = document.createElement('script');\n        script.src = 'https://assets.calendly.com/assets/external/widget.js';\n        script.async = true;\n        document.body.appendChild(script);\n      }\n\n      // Attendre que Calendly soit chargé puis initialiser le widget\n      const initCalendly = () => {\n        if (window.Calendly) {\n          window.Calendly.initInlineWidget({\n            url: CALENDLY_URL,\n            parentElement: document.querySelector('.calendly-inline-widget'),\n          });\n        } else {\n          setTimeout(initCalendly, 100);\n        }\n      };\n\n      setTimeout(initCalendly, 500);\n\n      // Écouter les événements Calendly\n      window.addEventListener('message', handleCalendlyEvent);\n    }\n\n    return () => {\n      window.removeEventListener('message', handleCalendlyEvent);\n    };\n  }, [isOpen, handleCalendlyEvent]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"calendly-modal-overlay\" onClick={onClose}>\n      <div className=\"calendly-modal-content\" onClick={(e) => e.stopPropagation()}>\n        <button className=\"calendly-modal-close\" onClick={onClose}>\n          ×\n        </button>\n        \n        {!isConfirmed ? (\n          <>\n            <div className=\"calendly-modal-header\">\n              <h2 className=\"calendly-modal-title\">Réservez votre audit gratuit</h2>\n              <p className=\"calendly-modal-subtitle\">\n                Choisissez un créneau qui vous convient pour discuter de vos résultats\n              </p>\n            </div>\n            <div \n              className=\"calendly-inline-widget\" \n              data-url={CALENDLY_URL}\n              style={{ minWidth: '320px', height: '700px' }}\n            />\n          </>\n        ) : (\n          <div className=\"calendly-confirmation\">\n            <div className=\"confirmation-icon\">✅</div>\n            <h2 className=\"confirmation-title\">Rendez-vous confirmé !</h2>\n            <p className=\"confirmation-message\">\n              Merci ! Votre rendez-vous a été enregistré. Vous allez recevoir un email de confirmation de Calendly.\n            </p>\n            <p className=\"confirmation-message\">\n              Nous vous enverrons également un récapitulatif de votre analyse par email.\n            </p>\n            <button className=\"confirmation-button\" onClick={onClose}>\n              Fermer\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default CalendlyModal;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}