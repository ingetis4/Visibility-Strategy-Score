{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import counterService from'../services/counter';import'./Counter.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Counter(){const[stats,setStats]=useState({total:0,today:0,formatted:{total:'0',today:'0'}});const[loading,setLoading]=useState(true);const[isUpdating,setIsUpdating]=useState(false);const[previousTotal,setPreviousTotal]=useState(0);const fetchStats=useCallback(async()=>{try{setIsUpdating(true);const data=await counterService.getStats();// Si le total a augmentÃ©, on a une nouvelle analyse\nsetStats(prevStats=>{if(data.total>prevStats.total&&prevStats.total>0){// Animation de cÃ©lÃ©bration\nconsole.log('[COUNTER] Nouvelle analyse dÃ©tectÃ©e !',prevStats.total,'â†’',data.total);}return data;});setPreviousTotal(data.total);}catch(error){console.error('[COUNTER] Erreur:',error);}finally{setLoading(false);// Garder l'indicateur de mise Ã  jour un peu plus longtemps pour que l'utilisateur le voie\nsetTimeout(()=>setIsUpdating(false),1000);}},[]);useEffect(()=>{fetchStats();// Ã‰couter les Ã©vÃ©nements de mise Ã  jour du compteur\nconst handleCounterUpdate=()=>{console.log('[COUNTER] Mise Ã  jour demandÃ©e');fetchStats();};window.addEventListener('counter:update',handleCounterUpdate);// RafraÃ®chir toutes les 5 minutes\nconst interval=setInterval(fetchStats,5*60*1000);return()=>{window.removeEventListener('counter:update',handleCounterUpdate);clearInterval(interval);};},[fetchStats]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"counter-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"counter-loading\",children:\"...\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"counter-container \".concat(isUpdating?'counter-updating':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"counter-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"counter-label\",children:\"Sites analys\\xE9s\"}),/*#__PURE__*/_jsx(\"span\",{className:\"counter-value\",children:stats.formatted.total||stats.total}),isUpdating&&/*#__PURE__*/_jsx(\"span\",{className:\"counter-update-indicator\",children:\"\\uD83D\\uDD04\"})]}),stats.today>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"counter-item counter-today\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"counter-label\",children:\"Aujourd'hui\"}),/*#__PURE__*/_jsx(\"span\",{className:\"counter-value\",children:stats.today})]})]});}export default Counter;","map":{"version":3,"names":["React","useState","useEffect","useCallback","counterService","jsx","_jsx","jsxs","_jsxs","Counter","stats","setStats","total","today","formatted","loading","setLoading","isUpdating","setIsUpdating","previousTotal","setPreviousTotal","fetchStats","data","getStats","prevStats","console","log","error","setTimeout","handleCounterUpdate","window","addEventListener","interval","setInterval","removeEventListener","clearInterval","className","children","concat"],"sources":["/Users/ares/DEV/Visibility strategy score/frontend/src/components/Counter.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport counterService from '../services/counter';\nimport './Counter.css';\n\nfunction Counter() {\n  const [stats, setStats] = useState({ total: 0, today: 0, formatted: { total: '0', today: '0' } });\n  const [loading, setLoading] = useState(true);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [previousTotal, setPreviousTotal] = useState(0);\n\n  const fetchStats = useCallback(async () => {\n    try {\n      setIsUpdating(true);\n      const data = await counterService.getStats();\n      \n      // Si le total a augmentÃ©, on a une nouvelle analyse\n      setStats((prevStats) => {\n        if (data.total > prevStats.total && prevStats.total > 0) {\n          // Animation de cÃ©lÃ©bration\n          console.log('[COUNTER] Nouvelle analyse dÃ©tectÃ©e !', prevStats.total, 'â†’', data.total);\n        }\n        return data;\n      });\n      \n      setPreviousTotal(data.total);\n    } catch (error) {\n      console.error('[COUNTER] Erreur:', error);\n    } finally {\n      setLoading(false);\n      // Garder l'indicateur de mise Ã  jour un peu plus longtemps pour que l'utilisateur le voie\n      setTimeout(() => setIsUpdating(false), 1000);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchStats();\n    \n    // Ã‰couter les Ã©vÃ©nements de mise Ã  jour du compteur\n    const handleCounterUpdate = () => {\n      console.log('[COUNTER] Mise Ã  jour demandÃ©e');\n      fetchStats();\n    };\n\n    window.addEventListener('counter:update', handleCounterUpdate);\n    \n    // RafraÃ®chir toutes les 5 minutes\n    const interval = setInterval(fetchStats, 5 * 60 * 1000);\n    \n    return () => {\n      window.removeEventListener('counter:update', handleCounterUpdate);\n      clearInterval(interval);\n    };\n  }, [fetchStats]);\n\n  if (loading) {\n    return (\n      <div className=\"counter-container\">\n        <div className=\"counter-loading\">...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`counter-container ${isUpdating ? 'counter-updating' : ''}`}>\n      <div className=\"counter-item\">\n        <span className=\"counter-label\">Sites analysÃ©s</span>\n        <span className=\"counter-value\">{stats.formatted.total || stats.total}</span>\n        {isUpdating && <span className=\"counter-update-indicator\">ðŸ”„</span>}\n      </div>\n      {stats.today > 0 && (\n        <div className=\"counter-item counter-today\">\n          <span className=\"counter-label\">Aujourd'hui</span>\n          <span className=\"counter-value\">{stats.today}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Counter;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}