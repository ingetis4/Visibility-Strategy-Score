{"ast":null,"code":"/**\n * Service centralisé pour les appels API\n * Gère automatiquement les URLs relatives ou absolues selon la configuration\n */\n\nconst API_BASE_URL = process.env.REACT_APP_API_URL || '';\n\n/**\n * Construit l'URL complète pour un endpoint API\n * @param {string} endpoint - L'endpoint (ex: '/api/analyze')\n * @returns {string} L'URL complète\n */\nfunction getApiUrl(endpoint) {\n  // Si API_BASE_URL est défini, l'utiliser\n  if (API_BASE_URL) {\n    // Enlever le slash final de API_BASE_URL s'il existe\n    const base = API_BASE_URL.endsWith('/') ? API_BASE_URL.slice(0, -1) : API_BASE_URL;\n    // Enlever le slash initial de endpoint s'il existe\n    const path = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\n    return `${base}${path}`;\n  }\n  // Sinon, utiliser l'URL relative (même domaine)\n  return endpoint;\n}\n\n/**\n * Effectue un appel API avec gestion d'erreurs améliorée\n * @param {string} endpoint - L'endpoint API\n * @param {object} options - Les options fetch\n * @returns {Promise<Response>}\n */\nasync function apiCall(endpoint, options = {}) {\n  const url = getApiUrl(endpoint);\n  const defaultOptions = {\n    headers: {\n      'Content-Type': 'application/json',\n      ...options.headers\n    }\n  };\n  const response = await fetch(url, {\n    ...defaultOptions,\n    ...options\n  });\n  if (!response.ok) {\n    // Essayer de parser le JSON, sinon utiliser le texte\n    let errorData;\n    const contentType = response.headers.get('content-type');\n    try {\n      if (contentType && contentType.includes('application/json')) {\n        errorData = await response.json();\n      } else {\n        const text = await response.text();\n        // Si c'est du HTML ou du texte d'erreur, créer un objet d'erreur\n        if (text.includes('Proxy') || text.includes('proxy') || text.includes('<html')) {\n          throw new Error('Erreur de connexion au serveur. Vérifiez votre connexion réseau.');\n        }\n        throw new Error(text || `Erreur HTTP ${response.status}`);\n      }\n    } catch (parseError) {\n      // Si le parsing JSON échoue, utiliser le message d'erreur\n      if (parseError.message.includes('Proxy') || parseError.message.includes('proxy')) {\n        throw new Error('Erreur de connexion au serveur. Vérifiez votre connexion réseau.');\n      }\n      throw parseError;\n    }\n    throw new Error(errorData.error || errorData.message || 'Erreur lors de l\\'appel API');\n  }\n\n  // Vérifier que la réponse est bien du JSON\n  const contentType = response.headers.get('content-type');\n  if (!contentType || !contentType.includes('application/json')) {\n    const text = await response.text();\n    if (text.includes('Proxy') || text.includes('proxy') || text.includes('<html')) {\n      throw new Error('Erreur de connexion au serveur. Vérifiez votre connexion réseau.');\n    }\n    throw new Error('Réponse invalide du serveur');\n  }\n  return response;\n}\nconst apiService = {\n  getApiUrl,\n  apiCall,\n  // Méthodes utilitaires\n  get: (endpoint, options = {}) => apiCall(endpoint, {\n    ...options,\n    method: 'GET'\n  }),\n  post: (endpoint, data, options = {}) => apiCall(endpoint, {\n    ...options,\n    method: 'POST',\n    body: JSON.stringify(data)\n  }),\n  put: (endpoint, data, options = {}) => apiCall(endpoint, {\n    ...options,\n    method: 'PUT',\n    body: JSON.stringify(data)\n  }),\n  delete: (endpoint, options = {}) => apiCall(endpoint, {\n    ...options,\n    method: 'DELETE'\n  })\n};\nexport default apiService;","map":{"version":3,"names":["API_BASE_URL","process","env","REACT_APP_API_URL","getApiUrl","endpoint","base","endsWith","slice","path","startsWith","apiCall","options","url","defaultOptions","headers","response","fetch","ok","errorData","contentType","get","includes","json","text","Error","status","parseError","message","error","apiService","method","post","data","body","JSON","stringify","put","delete"],"sources":["/Users/ares/DEV/Visibility strategy score/frontend/src/services/api.js"],"sourcesContent":["/**\n * Service centralisé pour les appels API\n * Gère automatiquement les URLs relatives ou absolues selon la configuration\n */\n\nconst API_BASE_URL = process.env.REACT_APP_API_URL || '';\n\n/**\n * Construit l'URL complète pour un endpoint API\n * @param {string} endpoint - L'endpoint (ex: '/api/analyze')\n * @returns {string} L'URL complète\n */\nfunction getApiUrl(endpoint) {\n  // Si API_BASE_URL est défini, l'utiliser\n  if (API_BASE_URL) {\n    // Enlever le slash final de API_BASE_URL s'il existe\n    const base = API_BASE_URL.endsWith('/') ? API_BASE_URL.slice(0, -1) : API_BASE_URL;\n    // Enlever le slash initial de endpoint s'il existe\n    const path = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\n    return `${base}${path}`;\n  }\n  // Sinon, utiliser l'URL relative (même domaine)\n  return endpoint;\n}\n\n/**\n * Effectue un appel API avec gestion d'erreurs améliorée\n * @param {string} endpoint - L'endpoint API\n * @param {object} options - Les options fetch\n * @returns {Promise<Response>}\n */\nasync function apiCall(endpoint, options = {}) {\n  const url = getApiUrl(endpoint);\n  const defaultOptions = {\n    headers: {\n      'Content-Type': 'application/json',\n      ...options.headers,\n    },\n  };\n\n  const response = await fetch(url, { ...defaultOptions, ...options });\n\n  if (!response.ok) {\n    // Essayer de parser le JSON, sinon utiliser le texte\n    let errorData;\n    const contentType = response.headers.get('content-type');\n    try {\n      if (contentType && contentType.includes('application/json')) {\n        errorData = await response.json();\n      } else {\n        const text = await response.text();\n        // Si c'est du HTML ou du texte d'erreur, créer un objet d'erreur\n        if (text.includes('Proxy') || text.includes('proxy') || text.includes('<html')) {\n          throw new Error('Erreur de connexion au serveur. Vérifiez votre connexion réseau.');\n        }\n        throw new Error(text || `Erreur HTTP ${response.status}`);\n      }\n    } catch (parseError) {\n      // Si le parsing JSON échoue, utiliser le message d'erreur\n      if (parseError.message.includes('Proxy') || parseError.message.includes('proxy')) {\n        throw new Error('Erreur de connexion au serveur. Vérifiez votre connexion réseau.');\n      }\n      throw parseError;\n    }\n    throw new Error(errorData.error || errorData.message || 'Erreur lors de l\\'appel API');\n  }\n\n  // Vérifier que la réponse est bien du JSON\n  const contentType = response.headers.get('content-type');\n  if (!contentType || !contentType.includes('application/json')) {\n    const text = await response.text();\n    if (text.includes('Proxy') || text.includes('proxy') || text.includes('<html')) {\n      throw new Error('Erreur de connexion au serveur. Vérifiez votre connexion réseau.');\n    }\n    throw new Error('Réponse invalide du serveur');\n  }\n\n  return response;\n}\n\nconst apiService = {\n  getApiUrl,\n  apiCall,\n  // Méthodes utilitaires\n  get: (endpoint, options = {}) => apiCall(endpoint, { ...options, method: 'GET' }),\n  post: (endpoint, data, options = {}) => \n    apiCall(endpoint, { \n      ...options, \n      method: 'POST', \n      body: JSON.stringify(data) \n    }),\n  put: (endpoint, data, options = {}) => \n    apiCall(endpoint, { \n      ...options, \n      method: 'PUT', \n      body: JSON.stringify(data) \n    }),\n  delete: (endpoint, options = {}) => apiCall(endpoint, { ...options, method: 'DELETE' }),\n};\n\nexport default apiService;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}